<head>
  <style>
    .log { font-family: "Courier New", Consolas, monospace; font-size: 80%; }
    .test-failed { background-color: #ffaaaa; }
    .test-passed { background-color: #aaffaa; }
  </style>
</head>
<body>
<h3><a href="https://github.com/zachjs/sv2v" target="_blank">zachjs-sv2v</a></h3>
<pre class="test-passed">
description: Tests imported from utd-sv
should_fail: 0
tags: utd-sv
incdirs: /home/travis/build/SymbiFlow/sv-tests/third_party/tests/utd-sv
top_module: 
type: parsing
mode: parsing
files: <a href="../../../../third_party/tests/utd-sv/ucb_flow_spi.v.html" target="file-frame">third_party/tests/utd-sv/ucb_flow_spi.v</a>
time_elapsed: 0.146s
ram usage: 12332 KB
</pre>
<pre class="log">

module ucb_flow_spi (
	ucb_iob_stall,
	rd_req_vld,
	wr_req_vld,
	ifill_req_vld,
	thr_id_in,
	buf_id_in,
	size_in,
	addr_in,
	data_in,
	ack_busy,
	int_busy,
	ucb_iob_vld,
	ucb_iob_data,
	clk,
	rst_l,
	iob_ucb_vld,
	iob_ucb_data,
	req_acpted,
	rd_ack_vld,
	rd_nack_vld,
	ifill_ack_vld,
	ifill_nack_vld,
	thr_id_out,
	buf_id_out,
	data128,
	data_out,
	int_vld,
	int_typ,
	int_thr_id,
	dev_id,
	int_stat,
	int_vec,
	iob_ucb_stall
);
	parameter IOB_UCB_WIDTH = 32;
	parameter UCB_IOB_WIDTH = 8;
	parameter REG_WIDTH = 64;
	input clk;
	input rst_l;
	input iob_ucb_vld;
	input [(IOB_UCB_WIDTH - 1):0] iob_ucb_data;
	output ucb_iob_stall;
	output rd_req_vld;
	output wr_req_vld;
	output ifill_req_vld;
	output [5:0] thr_id_in;
	output [1:0] buf_id_in;
	output [2:0] size_in;
	output [39:0] addr_in;
	output [63:0] data_in;
	input req_acpted;
	input rd_ack_vld;
	input rd_nack_vld;
	input ifill_ack_vld;
	input ifill_nack_vld;
	input [5:0] thr_id_out;
	input [1:0] buf_id_out;
	input data128;
	input [(REG_WIDTH - 1):0] data_out;
	output ack_busy;
	input int_vld;
	input [3:0] int_typ;
	input [5:0] int_thr_id;
	input [8:0] dev_id;
	input [31:0] int_stat;
	input [5:0] int_vec;
	output int_busy;
	output ucb_iob_vld;
	output [(UCB_IOB_WIDTH - 1):0] ucb_iob_data;
	input iob_ucb_stall;
	wire indata_buf_vld;
	wire [127:0] indata_buf;
	wire ucb_iob_stall_a1;
	wire read_pending;
	wire write_pending;
	wire ifill_pending;
	wire rd_buf;
	wire [1:0] buf_head_next;
	wire [1:0] buf_head;
	wire wr_buf;
	wire [1:0] buf_tail_next;
	wire [1:0] buf_tail;
	wire buf_full_next;
	wire buf_full;
	wire buf_empty_next;
	wire buf_empty;
	wire [117:0] req_in;
	wire buf0_en;
	wire [117:0] buf0;
	wire buf1_en;
	wire [117:0] buf1;
	wire [117:0] req_out;
	wire rd_req_vld_nq;
	wire wr_req_vld_nq;
	wire ifill_req_vld_nq;
	wire ack_buf_rd;
	wire ack_buf_wr;
	wire ack_buf_vld;
	wire ack_buf_vld_next;
	wire ack_buf_is_nack;
	wire ack_buf_is_data128;
	wire [3:0] ack_typ_out;
	wire [(REG_WIDTH + 11):0] ack_buf_in;
	wire [(REG_WIDTH + 11):0] ack_buf;
	wire [(((REG_WIDTH + 64) / UCB_IOB_WIDTH) - 1):0] ack_buf_vec;
	wire int_buf_rd;
	wire int_buf_wr;
	wire int_buf_vld;
	wire int_buf_vld_next;
	wire [56:0] int_buf_in;
	wire [56:0] int_buf;
	wire [(((REG_WIDTH + 64) / UCB_IOB_WIDTH) - 1):0] int_buf_vec;
	wire int_last_rd;
	wire outdata_buf_busy;
	wire outdata_buf_wr;
	wire [(REG_WIDTH + 63):0] outdata_buf_in;
	wire [(((REG_WIDTH + 64) / UCB_IOB_WIDTH) - 1):0] outdata_vec_in;
	ucb_bus_in #(
		IOB_UCB_WIDTH,
		64
	) ucb_bus_in(
		.rst_l(rst_l),
		.clk(clk),
		.vld(iob_ucb_vld),
		.data(iob_ucb_data),
		.stall(ucb_iob_stall),
		.indata_buf_vld(indata_buf_vld),
		.indata_buf(indata_buf),
		.stall_a1(ucb_iob_stall_a1)
	);
	assign read_pending = ((indata_buf[3:0] == 4&#39;b0100) &amp; indata_buf_vld);
	assign write_pending = ((indata_buf[3:0] == 4&#39;b0101) &amp; indata_buf_vld);
	assign ifill_pending = ((indata_buf[3:0] == 4&#39;b0110) &amp; indata_buf_vld);
	assign ucb_iob_stall_a1 = (((read_pending | write_pending) | ifill_pending) &amp; buf_full);
	assign rd_buf = req_acpted;
	assign buf_head_next = (~rst_l ? 2&#39;b01 : (rd_buf ? {buf_head[0:0], buf_head[1]} : buf_head));
	dff_ns #(2) buf_head_ff(
		.din(buf_head_next),
		.clk(clk),
		.q(buf_head)
	);
	assign wr_buf = (((read_pending | write_pending) | ifill_pending) &amp; ~buf_full);
	assign buf_tail_next = (~rst_l ? 2&#39;b01 : (wr_buf ? {buf_tail[0:0], buf_tail[1]} : buf_tail));
	dff_ns #(2) buf_tail_ff(
		.din(buf_tail_next),
		.clk(clk),
		.q(buf_tail)
	);
	assign buf_full_next = ((buf_head_next == buf_tail_next) &amp; wr_buf);
	dffrle_ns #(1) buf_full_ff(
		.din(buf_full_next),
		.rst_l(rst_l),
		.en((rd_buf | wr_buf)),
		.clk(clk),
		.q(buf_full)
	);
	assign buf_empty_next = (((buf_head_next == buf_tail_next) &amp; rd_buf) | ~rst_l);
	dffe_ns #(1) buf_empty_ff(
		.din(buf_empty_next),
		.en(((rd_buf | wr_buf) | ~rst_l)),
		.clk(clk),
		.q(buf_empty)
	);
	assign req_in = {indata_buf[127:64], indata_buf[54:15], indata_buf[14:12], indata_buf[11:10], indata_buf[9:4], ifill_pending, write_pending, read_pending};
	assign buf0_en = (buf_tail[0] &amp; wr_buf);
	dffe_ns #(118) buf0_ff(
		.din(req_in),
		.en(buf0_en),
		.clk(clk),
		.q(buf0)
	);
	assign buf1_en = (buf_tail[1] &amp; wr_buf);
	dffe_ns #(118) buf1_ff(
		.din(req_in),
		.en(buf1_en),
		.clk(clk),
		.q(buf1)
	);
	assign req_out = (buf_head[0] ? buf0 : (buf_head[1] ? buf1 : {118 {1&#39;b0}}));
	assign {data_in, addr_in, size_in, buf_id_in, thr_id_in, ifill_req_vld_nq, wr_req_vld_nq, rd_req_vld_nq} = req_out;
	assign rd_req_vld = (rd_req_vld_nq &amp; ~buf_empty);
	assign wr_req_vld = (wr_req_vld_nq &amp; ~buf_empty);
	assign ifill_req_vld = (ifill_req_vld_nq &amp; ~buf_empty);
	assign ack_buf_wr = (((rd_ack_vld | rd_nack_vld) | ifill_ack_vld) | ifill_nack_vld);
	assign ack_buf_vld_next = (ack_buf_wr ? 1&#39;b1 : (ack_buf_rd ? 1&#39;b0 : ack_buf_vld));
	dffrl_ns #(1) ack_buf_vld_ff(
		.din(ack_buf_vld_next),
		.clk(clk),
		.rst_l(rst_l),
		.q(ack_buf_vld)
	);
	dffe_ns #(1) ack_buf_is_nack_ff(
		.din((rd_nack_vld | ifill_nack_vld)),
		.en(ack_buf_wr),
		.clk(clk),
		.q(ack_buf_is_nack)
	);
	dffe_ns #(1) ack_buf_is_data128_ff(
		.din(data128),
		.en(ack_buf_wr),
		.clk(clk),
		.q(ack_buf_is_data128)
	);
	assign ack_typ_out = (rd_ack_vld ? 4&#39;b0001 : (rd_nack_vld ? 4&#39;b0000 : (ifill_ack_vld ? 4&#39;b0011 : 4&#39;b0111)));
	assign ack_buf_in = {data_out, buf_id_out, thr_id_out, ack_typ_out};
	dffe_ns #((REG_WIDTH + 12)) ack_buf_ff(
		.din(ack_buf_in),
		.en(ack_buf_wr),
		.clk(clk),
		.q(ack_buf)
	);
	assign ack_buf_vec = (ack_buf_is_nack ? {{(REG_WIDTH / UCB_IOB_WIDTH) {1&#39;b0}}, {(64 / UCB_IOB_WIDTH) {1&#39;b1}}} : (ack_buf_is_data128 ? {((REG_WIDTH + 64) / UCB_IOB_WIDTH) {1&#39;b1}} : {(128 / UCB_IOB_WIDTH) {1&#39;b1}}));
	assign ack_busy = ack_buf_vld;
	assign int_buf_wr = int_vld;
	assign int_buf_vld_next = (int_buf_wr ? 1&#39;b1 : (int_buf_rd ? 1&#39;b0 : int_buf_vld));
	dffrl_ns #(1) int_buf_vld_ff(
		.din(int_buf_vld_next),
		.clk(clk),
		.rst_l(rst_l),
		.q(int_buf_vld)
	);
	assign int_buf_in = {int_vec, int_stat, dev_id, int_thr_id, int_typ};
	dffe_ns #(57) int_buf_ff(
		.din(int_buf_in),
		.en(int_buf_wr),
		.clk(clk),
		.q(int_buf)
	);
	assign int_buf_vec = {{(REG_WIDTH / UCB_IOB_WIDTH) {1&#39;b0}}, {(64 / UCB_IOB_WIDTH) {1&#39;b1}}};
	assign int_busy = int_buf_vld;
	dffrle_ns #(1) int_last_rd_ff(
		.din(int_buf_rd),
		.en((ack_buf_rd | int_buf_rd)),
		.rst_l(rst_l),
		.clk(clk),
		.q(int_last_rd)
	);
	assign ack_buf_rd = ((~outdata_buf_busy &amp; ack_buf_vld) &amp; (~int_buf_vld | int_last_rd));
	assign int_buf_rd = ((~outdata_buf_busy &amp; int_buf_vld) &amp; (~ack_buf_vld | ~int_last_rd));
	assign outdata_buf_wr = (ack_buf_rd | int_buf_rd);
	assign outdata_buf_in = (ack_buf_rd ? {ack_buf[(REG_WIDTH + 11):12], {9 {1&#39;b0}}, {40 {1&#39;b0}}, {3 {1&#39;b0}}, ack_buf[11:10], ack_buf[9:4], ack_buf[3:0]} : {{REG_WIDTH {1&#39;b0}}, {7 {1&#39;b0}}, int_buf[56:51], int_buf[50:19], int_buf[18:10], int_buf[9:4], int_buf[3:0]});
	assign outdata_vec_in = (ack_buf_rd ? ack_buf_vec : int_buf_vec);
	ucb_bus_out #(
		UCB_IOB_WIDTH,
		REG_WIDTH
	) ucb_bus_out(
		.rst_l(rst_l),
		.clk(clk),
		.outdata_buf_wr(outdata_buf_wr),
		.outdata_buf_in(outdata_buf_in),
		.outdata_vec_in(outdata_vec_in),
		.outdata_buf_busy(outdata_buf_busy),
		.vld(ucb_iob_vld),
		.data(ucb_iob_data),
		.stall(iob_ucb_stall)
	);
endmodule

</pre>
</body>