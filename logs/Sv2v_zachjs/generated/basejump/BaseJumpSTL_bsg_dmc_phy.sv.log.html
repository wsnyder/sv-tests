<head>
  <style>
    .log { font-family: "Courier New", Consolas, monospace; font-size: 80%; }
    .test-failed { background-color: #ffaaaa; }
    .test-passed { background-color: #aaffaa; }
  </style>
</head>
<body>
<h3><a href="https://github.com/zachjs/sv2v" target="_blank">zachjs-sv2v</a></h3>
<pre class="test-passed">
description: Tests imported from basejump
should_fail: 0
tags: basejump
incdirs: /home/travis/build/SymbiFlow/sv-tests/third_party/cores/basejump_stl/bsg_dmc
top_module: 
type: parsing
mode: parsing
files: <a href="../../../../third_party/cores/basejump_stl/bsg_dmc/bsg_dmc_phy.v.html" target="file-frame">third_party/cores/basejump_stl/bsg_dmc/bsg_dmc_phy.v</a>
time_elapsed: 0.260s
ram usage: 12408 KB
</pre>
<pre class="log">

module tx_bit_slice (
	clk_2x_n,
	wrdata_en_90,
	wrdata_90,
	dq_o,
	dq_oe_n
);
	input clk_2x_n;
	input wrdata_en_90;
	input [1:0] wrdata_90;
	output reg dq_o;
	output reg dq_oe_n;
	reg odd;
	always @(posedge clk_2x_n)
		if (wrdata_en_90) begin
			odd &lt;= ~odd;
			if (odd)
				dq_o &lt;= wrdata_90[1];
			else
				dq_o &lt;= wrdata_90[0];
			dq_oe_n &lt;= 1&#39;b0;
		end
		else begin
			odd &lt;= 1&#39;b0;
			dq_oe_n &lt;= 1&#39;b1;
		end
endmodule
module rx_bit_slice (
	clk,
	write_pointer,
	read_pointer,
	dq_i,
	dqs_p,
	dqs_n,
	rddata_even,
	rddata_odd
);
	input clk;
	input [1:0] write_pointer;
	input [1:0] read_pointer;
	input dq_i;
	input dqs_p;
	input dqs_n;
	output reg rddata_even;
	output reg rddata_odd;
	reg [3:0] data_even;
	reg [3:0] data_odd;
	wire data_even_mux;
	wire data_odd_mux;
	always @(posedge dqs_p) data_even[write_pointer] &lt;= dq_i;
	always @(posedge dqs_n) data_odd[write_pointer] &lt;= dq_i;
	assign data_even_mux = data_even[read_pointer];
	assign data_odd_mux = data_odd[read_pointer];
	always @(posedge clk) begin
		rddata_even &lt;= data_even_mux;
		rddata_odd &lt;= data_odd_mux;
	end
endmodule
module bit_slice (
	clk,
	clk_2x_n,
	dqs_p,
	dqs_n,
	wrdata_en_90,
	wrdata_90,
	dq_o,
	dq_oe_n,
	dq_i,
	write_pointer,
	read_pointer,
	rddata_even,
	rddata_odd
);
	input clk;
	input clk_2x_n;
	input dqs_p;
	input dqs_n;
	input wrdata_en_90;
	input [1:0] wrdata_90;
	output wire dq_o;
	output wire dq_oe_n;
	input dq_i;
	input [1:0] write_pointer;
	input [1:0] read_pointer;
	output wire rddata_even;
	output wire rddata_odd;
	tx_bit_slice tx_bit_slice(
		.clk_2x_n(clk_2x_n),
		.wrdata_en_90(wrdata_en_90),
		.wrdata_90(wrdata_90),
		.dq_o(dq_o),
		.dq_oe_n(dq_oe_n)
	);
	rx_bit_slice rx_bit_slice(
		.clk(clk),
		.write_pointer(write_pointer),
		.read_pointer(read_pointer),
		.dq_i(dq_i),
		.dqs_p(dqs_p),
		.dqs_n(dqs_n),
		.rddata_even(rddata_even),
		.rddata_odd(rddata_odd)
	);
endmodule
module tx_byte_slice (
	clk_2x,
	clk_2x_n,
	wrdata_en,
	wrdata,
	wrdata_mask,
	dm_oe_n,
	dm_o,
	dq_oe_n,
	dq_o,
	dqs_p_oe_n,
	dqs_p_o,
	dqs_n_oe_n,
	dqs_n_o
);
	input clk_2x;
	input clk_2x_n;
	input wrdata_en;
	input [15:0] wrdata;
	input [1:0] wrdata_mask;
	output reg dm_oe_n;
	output reg dm_o;
	output reg [7:0] dq_oe_n;
	output reg [7:0] dq_o;
	output reg dqs_p_oe_n;
	output reg dqs_p_o;
	output reg dqs_n_oe_n;
	output reg dqs_n_o;
	reg wrdata_en_90;
	reg wrdata_en_180;
	wire wrdata_en_270;
	wire wrdata_en_360;
	reg [15:0] wrdata_90;
	wire [15:0] wrdata_180;
	wire [15:0] wrdata_270;
	reg [1:0] wrdata_mask_90;
	wire [1:0] wrdata_mask_180;
	wire [1:0] wrdata_mask_270;
	reg odd;
	always @(posedge clk_2x_n) begin
		wrdata_en_90 &lt;= wrdata_en;
		wrdata_90 &lt;= wrdata;
		wrdata_mask_90 &lt;= wrdata_mask;
	end
	always @(posedge clk_2x) wrdata_en_180 &lt;= wrdata_en;
	always @(posedge clk_2x) begin
		dqs_p_oe_n &lt;= ~(wrdata_en | wrdata_en_180);
		dqs_n_oe_n &lt;= ~(wrdata_en | wrdata_en_180);
	end
	always @(posedge clk_2x)
		if ((wrdata_en || wrdata_en_180)) begin
			dqs_p_o &lt;= ~dqs_p_o;
			dqs_n_o &lt;= ~dqs_n_o;
		end
		else begin
			dqs_p_o &lt;= 1&#39;b1;
			dqs_n_o &lt;= 1&#39;b0;
		end
	always @(posedge clk_2x_n)
		if (wrdata_en_90) begin
			odd &lt;= ~odd;
			if (odd) begin
				dq_o &lt;= wrdata_90[15:8];
				dm_o &lt;= wrdata_mask_90[1];
			end
			else begin
				dq_o &lt;= wrdata_90[7:0];
				dm_o &lt;= wrdata_mask_90[0];
			end
			dq_oe_n &lt;= 8&#39;h0;
			dm_oe_n &lt;= 1&#39;b0;
		end
		else begin
			odd &lt;= 1&#39;b0;
			dq_oe_n &lt;= 8&#39;hff;
			dm_oe_n &lt;= 1&#39;b1;
		end
endmodule
module rx_byte_slice (
	reset,
	clk,
	dqs_select,
	rp_inc,
	rddata,
	dq_i,
	dqs_p_i,
	dqs_n_i
);
	input reset;
	input clk;
	input dqs_select;
	input rp_inc;
	output [15:0] rddata;
	input [7:0] dq_i;
	input dqs_p_i;
	input dqs_n_i;
	wire dqs_p;
	wire dqs_n;
	reg [1:0] write_pointer;
	reg [1:0] read_pointer;
	genvar i;
	assign dqs_p = (dqs_select ? dqs_p_i : 1&#39;b0);
	assign dqs_n = (dqs_select ? dqs_n_i : 1&#39;b1);
	generate
		for (i = 0; (i &lt; 8); i = (i + 1)) begin : one_bit
			rx_bit_slice rx_bit_slice(
				.clk(clk),
				.write_pointer(write_pointer),
				.read_pointer(read_pointer),
				.dq_i(dq_i[i]),
				.dqs_p(dqs_p),
				.dqs_n(dqs_n),
				.rddata_even(rddata[i]),
				.rddata_odd(rddata[(i + 8)])
			);
		end
	endgenerate
	always @(posedge dqs_n or posedge reset)
		if (reset)
			write_pointer &lt;= &#39;b0;
		else
			write_pointer &lt;= (write_pointer + 1&#39;b1);
	always @(posedge clk)
		if (reset)
			read_pointer &lt;= &#39;b0;
		else if (rp_inc)
			read_pointer &lt;= (read_pointer + 1&#39;b1);
endmodule
module byte_slice (
	reset,
	clk,
	clk_2x,
	clk_2x_n,
	wrdata_en,
	wrdata,
	wrdata_mask,
	dm_oe_n,
	dm_o,
	dq_oe_n,
	dq_o,
	dqs_p_oe_n,
	dqs_p_o,
	dqs_n_oe_n,
	dqs_n_o,
	dqs_select,
	rp_inc,
	rddata,
	dq_i,
	dqs_p_i,
	dqs_n_i
);
	input reset;
	input clk;
	input clk_2x;
	input clk_2x_n;
	input wrdata_en;
	input [15:0] wrdata;
	input [1:0] wrdata_mask;
	output dm_oe_n;
	output dm_o;
	output [7:0] dq_oe_n;
	output [7:0] dq_o;
	output reg dqs_p_oe_n;
	output reg dqs_p_o;
	output reg dqs_n_oe_n;
	output reg dqs_n_o;
	input dqs_select;
	input rp_inc;
	output [15:0] rddata;
	input [7:0] dq_i;
	input dqs_p_i;
	input dqs_n_i;
	reg wrdata_en_90;
	reg wrdata_en_180;
	reg [15:0] wrdata_90;
	wire [15:0] wrdata_180;
	reg [1:0] wrdata_mask_90;
	wire [1:0] wrdata_mask_180;
	wire dqs_p;
	wire dqs_n;
	reg [1:0] write_pointer;
	reg [1:0] read_pointer;
	genvar i;
	always @(posedge clk_2x_n) begin
		wrdata_en_90 &lt;= wrdata_en;
		wrdata_90 &lt;= wrdata;
		wrdata_mask_90 &lt;= wrdata_mask;
	end
	always @(posedge clk_2x) wrdata_en_180 &lt;= wrdata_en;
	always @(posedge clk_2x) begin
		dqs_p_oe_n &lt;= ~(wrdata_en | wrdata_en_180);
		dqs_n_oe_n &lt;= ~(wrdata_en | wrdata_en_180);
	end
	always @(posedge clk_2x)
		if ((wrdata_en || wrdata_en_180)) begin
			dqs_p_o &lt;= ~dqs_p_o;
			dqs_n_o &lt;= ~dqs_n_o;
		end
		else begin
			dqs_p_o &lt;= 1&#39;b1;
			dqs_n_o &lt;= 1&#39;b0;
		end
	assign dqs_p = (dqs_select ? dqs_p_i : 1&#39;b0);
	assign dqs_n = (dqs_select ? dqs_n_i : 1&#39;b1);
	always @(posedge dqs_n or posedge reset)
		if (reset)
			write_pointer &lt;= &#39;b0;
		else
			write_pointer &lt;= (write_pointer + 1&#39;b1);
	always @(posedge clk)
		if (reset)
			read_pointer &lt;= &#39;b0;
		else if (rp_inc)
			read_pointer &lt;= (read_pointer + 1&#39;b1);
	generate
		for (i = 0; (i &lt; 8); i = (i + 1)) begin : bs
			bit_slice bit_slice(
				.clk(clk),
				.clk_2x_n(clk_2x_n),
				.dqs_p(dqs_p),
				.dqs_n(dqs_n),
				.wrdata_en_90(wrdata_en_90),
				.wrdata_90({wrdata_90[(8 + i)], wrdata_90[i]}),
				.dq_o(dq_o[i]),
				.dq_oe_n(dq_oe_n[i]),
				.dq_i(dq_i[i]),
				.write_pointer(write_pointer),
				.read_pointer(read_pointer),
				.rddata_even(rddata[i]),
				.rddata_odd(rddata[(8 + i)])
			);
		end
	endgenerate
	tx_bit_slice dm_bit_slice(
		.clk_2x_n(clk_2x_n),
		.wrdata_en_90(wrdata_en_90),
		.wrdata_90(wrdata_mask_90),
		.dq_o(dm_o),
		.dq_oe_n(dm_oe_n)
	);
endmodule
module bsg_dmc_phy (
	dfi_clk_i,
	dfi_clk_2x_i,
	dfi_rst_i,
	dfi_bank_i,
	dfi_address_i,
	dfi_cke_i,
	dfi_cs_n_i,
	dfi_ras_n_i,
	dfi_cas_n_i,
	dfi_we_n_i,
	dfi_reset_n_i,
	dfi_odt_i,
	dfi_wrdata_en_i,
	dfi_wrdata_i,
	dfi_wrdata_mask_i,
	dfi_rddata_en_i,
	dfi_rddata_o,
	dfi_rddata_valid_o,
	ck_p_o,
	ck_n_o,
	cke_o,
	ba_o,
	a_o,
	cs_n_o,
	ras_n_o,
	cas_n_o,
	we_n_o,
	reset_o,
	odt_o,
	dm_oe_n_o,
	dm_o,
	dqs_p_oe_n_o,
	dqs_p_ie_n_o,
	dqs_p_o,
	dqs_p_i,
	dqs_n_oe_n_o,
	dqs_n_ie_n_o,
	dqs_n_o,
	dqs_n_i,
	dq_oe_n_o,
	dq_o,
	dq_i,
	dqs_sel_cal
);
	parameter dq_data_width_p = &#34;inv&#34;;
	localparam dq_group_lp = (dq_data_width_p &gt;&gt; 3);
	input dfi_clk_i;
	input dfi_clk_2x_i;
	input dfi_rst_i;
	input [2:0] dfi_bank_i;
	input [15:0] dfi_address_i;
	input dfi_cke_i;
	input dfi_cs_n_i;
	input dfi_ras_n_i;
	input dfi_cas_n_i;
	input dfi_we_n_i;
	input dfi_reset_n_i;
	input dfi_odt_i;
	input dfi_wrdata_en_i;
	input [((2 * dq_data_width_p) - 1):0] dfi_wrdata_i;
	input [((2 * dq_group_lp) - 1):0] dfi_wrdata_mask_i;
	input dfi_rddata_en_i;
	output [((2 * dq_data_width_p) - 1):0] dfi_rddata_o;
	output reg dfi_rddata_valid_o;
	output ck_p_o;
	output ck_n_o;
	output reg cke_o;
	output reg [2:0] ba_o;
	output reg [15:0] a_o;
	output reg cs_n_o;
	output reg ras_n_o;
	output reg cas_n_o;
	output reg we_n_o;
	output reg reset_o;
	output reg odt_o;
	output [(dq_group_lp - 1):0] dm_oe_n_o;
	output [(dq_group_lp - 1):0] dm_o;
	output [(dq_group_lp - 1):0] dqs_p_oe_n_o;
	output [(dq_group_lp - 1):0] dqs_p_ie_n_o;
	output [(dq_group_lp - 1):0] dqs_p_o;
	input [(dq_group_lp - 1):0] dqs_p_i;
	output [(dq_group_lp - 1):0] dqs_n_oe_n_o;
	output [(dq_group_lp - 1):0] dqs_n_ie_n_o;
	output [(dq_group_lp - 1):0] dqs_n_o;
	input [(dq_group_lp - 1):0] dqs_n_i;
	output [((8 * dq_group_lp) - 1):0] dq_oe_n_o;
	output [((8 * dq_group_lp) - 1):0] dq_o;
	input [((8 * dq_group_lp) - 1):0] dq_i;
	input [1:0] dqs_sel_cal;
	wire clk_1x_0;
	wire clk_1x_180;
	wire clk_2x_0;
	wire clk_2x_180;
	reg [3:0] rddata_en;
	wire dqs_select;
	reg rp_inc;
	genvar i;
	always @(posedge clk_1x_180)
		if (dfi_rst_i) begin
			cke_o &lt;= 1&#39;b0;
			ba_o &lt;= 3&#39;b000;
			a_o &lt;= 16&#39;h0;
			cs_n_o &lt;= 1&#39;b1;
			ras_n_o &lt;= 1&#39;b1;
			cas_n_o &lt;= 1&#39;b1;
			we_n_o &lt;= 1&#39;b1;
			reset_o &lt;= 1&#39;b1;
			odt_o &lt;= 1&#39;b0;
		end
		else begin
			cke_o &lt;= dfi_cke_i;
			ba_o &lt;= dfi_bank_i;
			a_o &lt;= dfi_address_i;
			cs_n_o &lt;= dfi_cs_n_i;
			ras_n_o &lt;= dfi_ras_n_i;
			cas_n_o &lt;= dfi_cas_n_i;
			we_n_o &lt;= dfi_we_n_i;
			reset_o &lt;= dfi_reset_n_i;
			odt_o &lt;= dfi_odt_i;
		end
	always @(*) rddata_en[0+:1] = dfi_rddata_en_i;
	always @(posedge clk_2x_180)
		if (dfi_rst_i) begin
			rddata_en[1+:1] &lt;= 1&#39;b0;
			rddata_en[3+:1] &lt;= 1&#39;b0;
		end
		else begin
			rddata_en[1+:1] &lt;= rddata_en[0+:1];
			rddata_en[3+:1] &lt;= rddata_en[2+:1];
		end
	always @(posedge clk_2x_0)
		if (dfi_rst_i)
			rddata_en[2+:1] &lt;= 1&#39;b0;
		else
			rddata_en[2+:1] &lt;= rddata_en[1+:1];
	always @(posedge clk_1x_0)
		if (dfi_rst_i)
			rp_inc &lt;= 1&#39;b0;
		else
			rp_inc &lt;= dqs_select;
	bsg_mux #(
		.width_p(1),
		.els_p(4)
	) mux(
		.data_i(rddata_en),
		.sel_i(dqs_sel_cal),
		.data_o(dqs_select)
	);
	always @(posedge clk_1x_0)
		if (dfi_rst_i)
			dfi_rddata_valid_o &lt;= 1&#39;b0;
		else
			dfi_rddata_valid_o &lt;= rp_inc;
	assign clk_2x_0 = dfi_clk_2x_i;
	assign clk_2x_180 = ~dfi_clk_2x_i;
	assign clk_1x_0 = dfi_clk_i;
	assign clk_1x_180 = ~dfi_clk_i;
	assign ck_p_o = clk_1x_0;
	assign ck_n_o = clk_1x_180;
	assign dqs_p_ie_n_o = ~{dq_group_lp {(rddata_en[0+:1] | dqs_select)}};
	assign dqs_n_ie_n_o = ~{dq_group_lp {(rddata_en[0+:1] | dqs_select)}};
	wire [(((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) &gt;= 0) ? (((((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) &gt;= 0) ? ((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) : (2 - ((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1))) * 8) + -1) : ((((0 &gt;= (((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1)) ? (2 - ((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1)) : ((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1)) * 8) + (((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) * 8) - 1))):(((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) &gt;= 0) ? 0 : ((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) * 8))] dfi_wrdata_array;
	wire [(((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) &gt;= 0) ? (((((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) &gt;= 0) ? ((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) : (2 - ((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1))) * 8) + -1) : ((((0 &gt;= (((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1)) ? (2 - ((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1)) : ((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1)) * 8) + (((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) * 8) - 1))):(((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) &gt;= 0) ? 0 : ((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) * 8))] dfi_rddata_array;
	bsg_make_2D_array #(
		.width_p(8),
		.items_p(((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1))
	) wrdata_array(
		.i(dfi_wrdata_i),
		.o(dfi_wrdata_array)
	);
	bsg_flatten_2D_array #(
		.width_p(8),
		.items_p(((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1))
	) rddata_array(
		.i(dfi_rddata_array),
		.o(dfi_rddata_o)
	);
	generate
		for (i = 0; (i &lt; dq_group_lp); i = (i + 1)) begin : one_byte
			byte_slice byte_slice(
				.reset(dfi_rst_i),
				.clk(clk_1x_0),
				.clk_2x(clk_2x_0),
				.clk_2x_n(clk_2x_180),
				.wrdata_en(dfi_wrdata_en_i),
				.wrdata({dfi_wrdata_array[((((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) &gt;= 0) ? (dq_group_lp + i) : (0 - ((dq_group_lp + i) - (((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1)))) * 8)+:8], dfi_wrdata_array[((((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) &gt;= 0) ? i : (0 - (i - (((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1)))) * 8)+:8]}),
				.wrdata_mask({dfi_wrdata_mask_i[(dq_group_lp + i)], dfi_wrdata_mask_i[i]}),
				.dm_oe_n(dm_oe_n_o[i]),
				.dm_o(dm_o[i]),
				.dq_oe_n(dq_oe_n_o[(8 * i)+:8]),
				.dq_o(dq_o[(8 * i)+:8]),
				.dqs_p_oe_n(dqs_p_oe_n_o[i]),
				.dqs_p_o(dqs_p_o[i]),
				.dqs_n_oe_n(dqs_n_oe_n_o[i]),
				.dqs_n_o(dqs_n_o[i]),
				.dqs_select(dqs_select),
				.rp_inc(rp_inc),
				.rddata({dfi_rddata_array[((((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) &gt;= 0) ? (dq_group_lp + i) : (0 - ((dq_group_lp + i) - (((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1)))) * 8)+:8], dfi_rddata_array[((((((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1) &gt;= 0) ? i : (0 - (i - (((dq_data_width_p &gt;&gt; 3) &lt;&lt; 1) - 1)))) * 8)+:8]}),
				.dq_i(dq_i[(8 * i)+:8]),
				.dqs_p_i(dqs_p_i[i]),
				.dqs_n_i(dqs_n_i[i])
			);
		end
	endgenerate
endmodule

</pre>
</body>